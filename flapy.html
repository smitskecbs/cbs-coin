<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>CBS Jump — From Underground to Heaven</title>
<style>
  html,body{height:100%;margin:0}
  body{background:linear-gradient(180deg,#0a0d12,#1a1f29);overflow:hidden}
  canvas{display:block;width:100vw;height:100vh}
  .hud{
    position:fixed;top:8px;left:50%;transform:translateX(-50%);z-index:2;
    color:#fff;font:700 24px system-ui,sans-serif;text-shadow:0 2px 4px rgba(0,0,0,.6);user-select:none
  }
  .subhud{
    position:fixed;top:40px;left:50%;transform:translateX(-50%);z-index:2;
    color:#cfe6ff;font:600 14px system-ui,sans-serif;text-shadow:0 1px 3px rgba(0,0,0,.6)
  }
  .overlay{
    position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.45);z-index:3
  }
  .card{
    background:rgba(20,20,32,.86);padding:22px 26px;border-radius:16px;color:#fff;text-align:center;max-width:420px;width:min(92vw,420px)
  }
  .btn{padding:10px 16px;border-radius:12px;background:rgba(255,255,255,.1);color:#fff;border:1px solid rgba(255,255,255,.25);cursor:pointer}
</style>
</head>
<body>
  <div id="scoreHud" class="hud">0 m</div>
  <div id="levelHud" class="subhud">Ondergrond</div>

  <div id="overlay" class="overlay">
    <div class="card">
      <h2 style="margin:0 0 8px 0">CBS Jump</h2>
      <p style="margin:0 0 10px 0">Tik/klik (of <b>SPATIE</b>) om op de <b>platte CBS-munten</b> te springen.<br/>Klim van de ondergrond naar de hemel!</p>
      <button id="startBtn" class="btn">Start</button>
    </div>
  </div>

  <canvas id="game"></canvas>

<script>
/* ===== Canvas ===== */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let W,H,DPR=Math.min(2,window.devicePixelRatio||1);
function resize(){ W=innerWidth; H=innerHeight; canvas.width=W*DPR; canvas.height=H*DPR; ctx.setTransform(DPR,0,0,DPR,0,0) }
addEventListener('resize',resize,{passive:true}); resize();

/* ===== Asset ===== */
const logo = new Image(); logo.src = 'logo.png'; // centraal logo voor coin & platforms

/* ===== Game State ===== */
let running=false, over=false, started=false;
let scoreM=0; // meters
const HUD = {
  score: document.getElementById('scoreHud'),
  level: document.getElementById('levelHud'),
  overlay: document.getElementById('overlay'),
};
const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

// speler (CBS coin)
const player = {
  x: W*0.35,
  y: H*0.75,
  r: Math.max(24, Math.min(40, H*0.04)), // radius voor collider
  vy: 0,
  onGround: false,
  coyote: 0,      // paar ms springen na het loslaten van platform
  jumpV: -(isMobile? 520:560),
};

// physics
const phys = {
  g: isMobile? 1600: 1800,   // zwaartekracht
  scrollEase: 0.08,          // camera easing
};

let camY = 0;               // camera (wereld y offset)
let worldYTop = 0;          // hoogste punt dat we bereikten (voor score)
let last = 0;

const platforms = [];        // {x,y,w,h,phase,speed,dir}
const PLATFORM_MIN_GAP_Y = 110;     // verticale afstand
const PLATFORM_MAX_GAP_Y = 170;
const PLATFORM_SPEED = isMobile? 55 : 70;
const PLATFORM_W = () => Math.max(90, Math.min(160, W*0.2)); // breedte schaalt met scherm
const PLATFORM_H = () => Math.max(16, Math.min(22, H*0.018));

/* ===== World / Levels by altitude (0 at start, negative is upwards) ===== */
function levelName(yWorld){ // yWorld is wereld-hoogte (negatief = hoger)
  const h = -yWorld;
  if(h < 600) return 'Ondergrond';
  if(h < 1800) return 'Aarde';
  if(h < 3200) return 'Wolken';
  if(h < 5200) return 'Ruimte';
  return 'Hemel';
}
function bgFill(yWorld){
  const h = -yWorld;
  if(h < 600) return ['#24160e','#3b291f'];            // Ondergrond bruin
  if(h < 1800) return ['#1a2932','#294b58'];           // Aarde blauwgroen
  if(h < 3200) return ['#0d1620','#2a394d'];           // Wolken koel
  if(h < 5200) return ['#06070e','#0b1120'];           // Ruimte donker
  return ['#0e0c1b','#2a2142'];                        // Hemel mystiek paars
}

/* ===== Input: one-tap jump ===== */
function onPress(){
  if(!started){ start(); return; }
  if(over) return;
  if(player.onGround || player.coyote > 0){
    player.vy = player.jumpV;
    player.onGround = false;
    player.coyote = 0;
  }
}
addEventListener('keydown', e=>{ if(e.code==='Space'){ e.preventDefault(); onPress(); }});
addEventListener('pointerdown', onPress);
document.getElementById('startBtn').onclick = onPress;

/* ===== Platform helpers ===== */
function spawnInitialPlatforms(){
  platforms.length = 0;
  let y = player.y + 40; // eentje onder speler
  for(let i=0;i<18;i++){
    const w = PLATFORM_W(), h = PLATFORM_H();
    const x = rand(w*0.5, W - w*0.5);
    y -= rand(PLATFORM_MIN_GAP_Y, PLATFORM_MAX_GAP_Y);
    platforms.push(makePlatform(x, y, w, h));
  }
}
function makePlatform(x,y,w,h){
  return {
    x, y, w, h,
    phase: Math.random()*Math.PI*2,
    speed: PLATFORM_SPEED * (0.6 + Math.random()*0.8), // variatie
    dir: Math.random()<0.5 ? -1:1,                     // L/R richting
  };
}
function maybeSpawnAbove(){
  // zorg dat er altijd platforms boven camera
  const highest = platforms.reduce((m,p)=>Math.min(m,p.y), Infinity);
  while(highest > camY - H*0.8){
    const w = PLATFORM_W(), h = PLATFORM_H();
    const x = rand(w*0.5, W - w*0.5);
    const topY = (platforms.reduce((m,p)=>Math.min(m,p.y), Infinity)) - rand(PLATFORM_MIN_GAP_Y, PLATFORM_MAX_GAP_Y);
    platforms.push(makePlatform(x, topY, w, h));
    break;
  }
}
function updatePlatforms(dt){
  for(const p of platforms){
    p.phase += dt;
    p.x += Math.sin(p.phase)*p.dir*p.speed*dt; // soepel bewegen
    // bounce tegen randen
    const half = p.w*0.5;
    if(p.x - half < 10){ p.x = 10 + half; p.dir = 1; }
    if(p.x + half > W-10){ p.x = W-10 - half; p.dir = -1; }
  }
  // platforms onder de camera weggooien
  for(let i=platforms.length-1;i>=0;i--){
    if(platforms[i].y - camY > H + 200){ platforms.splice(i,1); }
  }
}

/* ===== Draw platform: platte CBS-munt (ellips + logo) ===== */
function drawFlatCoin(x,y,w,h){
  // ellips body (goud)
  const grd = ctx.createLinearGradient(x, y-h*0.5, x, y+h*0.5);
  grd.addColorStop(0, '#fff6c8');
  grd.addColorStop(0.5, '#f6d36a');
  grd.addColorStop(1, '#b78628');
  ctx.fillStyle = grd;
  ctx.beginPath(); roundEllipsePath(x,y,w,h); ctx.fill();

  // top highlight
  ctx.globalAlpha=0.25;
  ctx.fillStyle = '#ffffff';
  ctx.beginPath(); roundEllipsePath(x, y-h*0.15, w*0.9, h*0.6); ctx.fill();
  ctx.globalAlpha=1;

  // logo perspectief
  if(logo.complete){
    ctx.save();
    ctx.beginPath(); roundEllipsePath(x,y,w*0.82,h*0.82); ctx.clip();
    // “perspectief”: trek wat in de hoogte samen
    const imgW = w*0.82, imgH = imgW; // vierkant
    ctx.drawImage(logo, x-imgW/2, y-imgH/2, imgW, imgH);
    ctx.restore();
  }

  // rand
  ctx.lineWidth = 2;
  ctx.strokeStyle = 'rgba(255,255,255,0.6)';
  ctx.beginPath(); roundEllipsePath(x,y,w,h); ctx.stroke();
}
function roundEllipsePath(x,y,w,h){
  // ellips met zachte randen
  const rx=w/2, ry=h/2;
  ctx.ellipse(x,y,rx,ry,0,0,Math.PI*2);
}

/* ===== Player draw: staande coin (zonder vleugels) ===== */
function drawPlayer(){
  const x=player.x, y=player.y - camY, r=player.r;
  // coin body
  const grad=ctx.createRadialGradient(x-r*0.35,y-r*0.35,r*0.2, x,y,r*1.15);
  grad.addColorStop(0,'#fff6c8'); grad.addColorStop(0.55,'#f6d36a'); grad.addColorStop(1,'#b78628');
  ctx.fillStyle=grad; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
  // rim
  ctx.lineWidth=4; ctx.strokeStyle='rgba(255,255,255,0.55)';
  ctx.beginPath(); ctx.arc(x,y,r-2,0,Math.PI*2); ctx.stroke();
  // logo
  if(logo.complete){
    ctx.save(); ctx.beginPath(); ctx.arc(x,y,r-4,0,Math.PI*2); ctx.clip();
    ctx.drawImage(logo, x-r*0.95, y-r*0.95, r*1.9, r*1.9); ctx.restore();
  }
}

/* ===== Background (per level) ===== */
function drawBackground(){
  const [c1,c2] = bgFill(camY);
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,c1); g.addColorStop(1,c2);
  ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

  // extra details per zone
  const h = -camY;
  if(h > 3200 && h < 5200){
    // ruimte – sterren
    drawStars(70, 0.6);
  } else if(h >= 5200){
    // hemel – zachte gloed
    const rg = ctx.createRadialGradient(W*0.5, H*0.3, 80, W*0.5, H*0.3, Math.max(W,H));
    rg.addColorStop(0,'rgba(255,255,255,0.18)'); rg.addColorStop(1,'rgba(255,255,255,0)');
    ctx.fillStyle=rg; ctx.fillRect(0,0,W,H);
  } else if(h < 600){
    // ondergrond – subtiele textuur lijnen
    ctx.globalAlpha=0.08; ctx.strokeStyle='#000';
    for(let i=0;i<10;i++){ ctx.beginPath(); ctx.moveTo(0, H-(i*14)); ctx.lineTo(W, H-(i*14)); ctx.stroke(); }
    ctx.globalAlpha=1;
  }
}
function drawStars(n, maxAlpha){
  for(let i=0;i<n;i++){
    const x = (i*1237 % W); // cheap pseudo spread
    const y = (i*911  % H);
    const r = (i%3===0)?1.6:(i%3===1?1.2:0.8);
    ctx.globalAlpha = (0.3 + (i%7)/10) * maxAlpha;
    ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2);
    ctx.fillStyle = '#cfe6ff'; ctx.fill();
  }
  ctx.globalAlpha = 1;
}

/* ===== Lifecycle ===== */
function start(){
  started=true; running=true; over=false;
  scoreM=0; worldYTop = 0;
  camY = 0;
  player.x = W*0.35; player.y = H*0.75; player.vy = 0; player.onGround=false; player.coyote=0;
  spawnInitialPlatforms();
  HUD.overlay.style.display='none';
  HUD.score.textContent = '0 m';
  HUD.level.textContent = 'Ondergrond';
  last = performance.now();
  requestAnimationFrame(loop);
}
function gameOver(){
  running=false; over=true;
  // optionele scoreboard hooks
  try{
    if(typeof window.submitScore==='function') window.submitScore(Math.floor(scoreM));
    else if(typeof window.saveScore==='function') window.saveScore(Math.floor(scoreM));
    window.dispatchEvent(new CustomEvent('cbs-score',{detail:{score:Math.floor(scoreM),game:'cbs-jump'}}));
  }catch(e){}
  HUD.overlay.innerHTML = `
    <div class="card">
      <h2 style="margin:0 0 8px 0">Game Over</h2>
      <p style="margin:0 0 12px 0">Hoogte: <b>${Math.floor(scoreM)} m</b><br/><span style="opacity:.8">${levelName(camY)}</span></p>
      <button class="btn" onclick="(${start.toString()})()">Opnieuw</button>
    </div>`;
  HUD.overlay.style.display='grid';
}

/* ===== Main loop ===== */
function loop(now){
  if(!running) return;
  const dt = Math.min(0.032, (now-last)/1000); last = now;

  // gravity
  player.vy += phys.g * dt;
  player.y  += player.vy * dt;

  // coyote time aftellen
  if(player.onGround) player.coyote = 0.1; else player.coyote = Math.max(0, player.coyote - dt);
  player.onGround = false;

  // platform update + collisions
  updatePlatforms(dt);

  // collision (axis aligned platform, coin as circle vs ellipse -> approx AABB)
  for(const p of platforms){
    // AABB check
    if(Math.abs(player.x - p.x) < (p.w/2 + player.r*0.6)){ // iets tolerant
      const py = player.y + player.r;       // onderkant speler
      const top = p.y - p.h/2;
      const prevPy = player.y - player.vy*dt + player.r;
      // land van boven (crossing)
      if(prevPy <= top && py >= top && player.vy > 0){
        player.y = top - player.r;
        player.vy = 0;
        player.onGround = true;
      }
    }
  }

  // camera volgt omhoog (alleen naar boven)
  const targetCam = Math.min(camY, player.y - H*0.45);
  camY = camY + (targetCam - camY) * phys.scrollEase;

  // score = hoogste bereikte hoogte (in meters)
  worldYTop = Math.min(worldYTop, camY);
  const meters = Math.floor(-worldYTop/3); // schaal naar “meters”
  if(meters !== Math.floor(scoreM)){
    scoreM = meters;
    HUD.score.textContent = `${meters} m`;
    HUD.level.textContent = levelName(camY);
  }

  // dood-condities (onder beeld vallen)
  if(player.y - camY > H + 160) return gameOver();

  // nieuwe platforms bovenaan toevoegen
  maybeSpawnAbove();

  // draw
  ctx.clearRect(0,0,W,H);
  drawBackground();

  // platforms
  for(const p of platforms){
    const sy = p.y - camY;
    if(sy < -80 || sy > H+80) continue;
    drawFlatCoin(p.x, sy, p.w, p.h);
  }

  // player
  drawPlayer();

  requestAnimationFrame(loop);
}

/* ===== Utils ===== */
function rand(a,b){ return a + Math.random()*(b-a); }
</script>
</body>
</html>

