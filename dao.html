<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CBS DAO â€“ Stemmen op voorstel</title>
  <style>
    body {
      background-color: #000;
      color: #00ffcc;
      font-family: 'Orbitron', sans-serif;
      text-align: center;
      padding: 20px;
    }
    h1, h2 {
      color: #00ffff;
    }
    .question {
      font-size: 1.5rem;
      color: #39ff14;
      margin: 20px 0;
    }
    .highlight {
      color: #ff6600;
    }
    button {
      background-color: #00ffcc;
      border: none;
      padding: 10px 20px;
      margin: 10px;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 8px;
    }
    button:hover {
      background-color: #00ffaa;
    }
    pre {
      background: #0f0f0f;
      color: #00ffcc;
      padding: 10px;
      border-radius: 8px;
      text-align: left;
      overflow-x: auto;
    }
    .info {
      margin: 10px 0;
      font-size: 0.9rem;
      color: #66ffff;
    }
  </style>
</head>
<body>

  <h1>CBS DAO â€“ Stemmen op voorstel</h1>
  <div class="info">
    Network: <strong>Devnet</strong> â€¢ RPC: <a href="https://api.devnet.solana.com" target="_blank" style="color:#00ffcc;">https://api.devnet.solana.com</a>
  </div>

  <div class="question">ðŸ”¥ 1 Miljoen CBS burnen â€” YES of NO? ðŸ”¥</div>

  <div id="wallet-info">Wallet: niet verbonden</div>
  <div>Program ID: <span id="program-id">FZGYyZ9hwUBriGpCH65vswS2VDoCyoC92rPoBPeBsuUY</span></div>
  <div>Proposal: <span id="proposal-id">9ALSSyJxAPCgyEcgJmVLnCTV5yPzbJAhUyeWMRv4kYYe</span></div>
  <div>Vote receipt PDA: <span id="vote-receipt">-</span></div>

  <br>
  <button id="connect-wallet">Connect Phantom</button>
  <button id="vote-yes" disabled>Stem YES</button>
  <button id="vote-no" disabled>Stem NO</button>

  <div class="info">
    Tip: Zet Phantom in <strong>Devnet</strong>.  
    In Phantom â†’ Settings â†’ Developer Settings â†’ Change Network â†’ Devnet.
  </div>

  <pre id="log"></pre>

  <script type="module">
    import {
      Connection,
      PublicKey,
      Transaction,
      SystemProgram
    } from "https://cdn.jsdelivr.net/npm/@solana/web3.js@1.91.4/+esm";

    const programId = new PublicKey("FZGYyZ9hwUBriGpCH65vswS2VDoCyoC92rPoBPeBsuUY");
    const proposal = new PublicKey("9ALSSyJxAPCgyEcgJmVLnCTV5yPzbJAhUyeWMRv4kYYe");

    const connection = new Connection("https://api.devnet.solana.com");

    let wallet = null;

    function log(message) {
      document.getElementById("log").textContent += message + "\n";
    }

    document.getElementById("connect-wallet").addEventListener("click", async () => {
      if (!window.solana || !window.solana.isPhantom) {
        alert("Phantom Wallet niet gevonden!");
        return;
      }
      const resp = await window.solana.connect();
      wallet = resp.publicKey;
      document.getElementById("wallet-info").textContent = "Wallet: " + wallet.toString();
      document.getElementById("vote-yes").disabled = false;
      document.getElementById("vote-no").disabled = false;
      log("âœ… Verbonden met: " + wallet.toString());
    });

    async function vote(yes) {
      try {
        const tx = new Transaction().add(
          SystemProgram.transfer({
            fromPubkey: wallet,
            toPubkey: wallet, // Dummy TX voor demo
            lamports: 0
          })
        );

        tx.feePayer = wallet;
        tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

        const { signature } = await window.solana.signAndSendTransaction(tx);
        log(`â³ Verstuurd, wachten op finalisatieâ€¦ ${signature}`);

        await connection.confirmTransaction(signature, "finalized");
        log(`âœ… Stem ${yes ? "YES" : "NO"} bevestigd: ${signature}`);
        log(`ðŸ”— Explorer: https://explorer.solana.com/tx/${signature}?cluster=devnet`);
      } catch (err) {
        log(`âŒ Fout: ${err.message}`);
      }
    }

    document.getElementById("vote-yes").addEventListener("click", () => vote(true));
    document.getElementById("vote-no").addEventListener("click", () => vote(false));

  </script>

</body>
</html>

