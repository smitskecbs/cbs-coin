<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CBS Coin ‚Äì Community Builds Sovereignty</title>

  <!-- Font + confetti -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    :root{
      --bg1:#0f0f0f;--bg2:#1a1a1a;--fg:#00ffcc;--cyan:#00ffff;
      --panel:#111;--muted:#999;--border:#00ffcc;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Orbitron',sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--fg);display:flex;flex-direction:column;align-items:center;padding:2rem}
    nav{width:100%;background:#111;padding:1rem;text-align:center;margin-bottom:2rem;border-bottom:1px solid #0c2020}
    nav a{margin:0 .8rem;color:var(--cyan);text-decoration:none;font-weight:700}
    nav a:hover{text-decoration:underline}
    header{text-align:center;width:100%}
    h1{font-size:3rem;margin:.5rem 0 .2rem}
    h2{font-size:1.35rem;font-weight:400;color:var(--muted);margin:.4rem 0 1rem}
    .logo{margin:1rem 0;max-width:180px}
    .section{max-width:900px;background:#111;padding:1.4rem;margin:1rem 0;border:1px solid var(--border);border-radius:12px}
    a{color:var(--cyan);text-decoration:none}
    a:hover{text-decoration:underline}
    footer{margin-top:2rem;font-size:.9rem;color:#aaa;text-align:center}
    .social-links{display:flex;justify-content:center;gap:1rem;flex-wrap:wrap;margin:1rem 0}
    .social-links a{display:inline-flex;align-items:center;padding:.5rem 1rem;background:#1a1a1a;border:1px solid var(--cyan);border-radius:6px;font-weight:700;color:var(--cyan)}
    .social-links a:hover{background:var(--cyan);color:#000}

    /* Airdrop */
    #airdropBtn{
      padding:1rem 2.2rem;font-size:1.15rem;font-weight:800;
      background:var(--fg);color:#001c1a;border:none;border-radius:12px;cursor:pointer;
      box-shadow:0 0 10px var(--fg),0 0 40px var(--fg),0 0 80px var(--fg);
      transition:transform .2s ease,box-shadow .2s ease;
    }
    #airdropBtn:hover{transform:scale(1.05);box-shadow:0 0 20px var(--cyan),0 0 60px var(--cyan),0 0 100px var(--cyan)}
    #status{min-height:1.5rem;margin-top:.7rem}
    .ok{color:#5aff86} .warn{color:#ffd166} .err{color:#ff6b6b}
  </style>
</head>
<body>
  <nav>
    <a href="index.html">Home</a>
    <a href="roadmap.html">Roadmap</a>
    <a href="tokenomics.html">Tokenomics</a>
    <a href="litepaper.html">Litepaper</a>
    <a href="dao-mainnet/dao.html">DAO</a>
    <a href="mailto:smitskecbs@gmail.com">Contact</a>
  </nav>

  <header>
    <img class="logo" alt="CBS Coin Logo"
         src="https://cyan-persistent-stork-902.mypinata.cloud/ipfs/bafybeia7qejzloll6teyt4o4orvd7bnvkg4thrfajv4rgb3fmm2odeweoa/logo.png" />
    <h1>CBS Coin</h1>
    <h2>Community Builds Sovereignty</h2>
    <div class="social-links">
      <a href="https://t.me/CBS_Coin" target="_blank" rel="noreferrer">Telegram</a>
      <a href="https://twitter.com/CBS_Coin" target="_blank" rel="noreferrer">X (Twitter)</a>
    </div>
  </header>

  <!-- AIRDROP -->
  <section class="section" style="text-align:center">
    <h2>üéÅ airdrop </h2>
    <p>verbind met phantom.</p>
    <button id="airdropBtn">üéÅ Claim 250 CBS</button>
    <p id="status"></p>
  </section>

  <!-- INFO -->
  <section class="section">
    <h3>üì¶ Token Info</h3>
    <ul>
      <li><strong>Tokennaam:</strong> CBS Coin</li>
      <li><strong>Symbool:</strong> CBS</li>
      <li><strong>Totale supply:</strong> 100.000.000</li>
      <li><strong>Mint authority:</strong> <em>uitgeschakeld</em></li>
      <li><strong>Freeze authority:</strong> <em>uitgeschakeld</em></li>
      <li><strong>Explorer:</strong>
        <a href="https://solscan.io/token/B9z8cEWFmc7LvQtjKsaLoKqW5MJmGRCWqs1DPKupCfkk" target="_blank" rel="noreferrer">
          Bekijk op Solscan
        </a>
      </li>
    </ul>
    <div class="social-links" style="justify-content:flex-start;gap:.6rem;flex-wrap:wrap">
      <a href="https://www.geckoterminal.com/nl/solana/pools/7RSeJd8C1cXA95Vfcz6CregUofj4dbmHgsxkF7zdWhVE" target="_blank" rel="noreferrer">Koop op GeckoTerminal</a>
      <a href="https://birdeye.so/token/B9z8cEWFmc7LvQtjKsaLoKqW5MJmGRCWqs1DPKupCfkk?chain=solana" target="_blank" rel="noreferrer">Koop op Birdeye</a>
      <a href="https://raydium.io/swap/?inputCurrency=sol&outputCurrency=B9z8cEWFmc7LvQtjKsaLoKqW5MJmGRCWqs1DPKupCfkk" target="_blank" rel="noreferrer">Koop op Raydium</a>
    </div>
  </section>

  <section class="section">
    <h3>üìÑ Whitepaper & Roadmap</h3>
    <p>
      Bekijk onze visie en plannen in de <a href="litepaper.html" target="_blank" rel="noreferrer">litepaper</a>.
      De roadmap bevat o.a. liquidity pools, DAO integratie en tokenverificatie op grote platforms.
    </p>
  </section>

  <footer>
    ¬© 2025 CBS Coin ‚Äì Sovereignty through community.
    <div class="social-links" style="justify-content:center;margin-top:.6rem">
      <a href="https://t.me/CBS_Coin" target="_blank" rel="noreferrer">Telegram</a>
      <a href="https://twitter.com/CBS_Coin" target="_blank" rel="noreferrer">X (Twitter)</a>
    </div>
  </footer>

  <!-- Airdrop front-end: gebruiker tekent & betaalt fee -->
  <script type="module">
    const ENDPOINT   = "https://cbs-coin.vercel.app/api/airdrop-cbs";
    // Fallback voor raw send via je Vercel RPC-proxy (optioneel; laat staan)
    const RPC_PROXY  = "https://cbs-coin.vercel.app/api/rpc";

    const statusEl = document.getElementById("status");
    const btn = document.getElementById("airdropBtn");
    const setOK  = (html)=>{ statusEl.className="ok";  statusEl.innerHTML = html; };
    const setERR = (html)=>{ statusEl.className="err"; statusEl.innerHTML = html; };
    const link = (href, text)=>`<a href="${href}" target="_blank" rel="noreferrer">${text}</a>`;

    // Robuuste base64 helpers
    function u8ToB64(u8){
      let s = ""; for (let i=0;i<u8.length;i++) s += String.fromCharCode(u8[i]);
      return btoa(s);
    }
    function b64ToU8(b64){
      b64 = (b64||"").trim().replace(/[\r\n\s]/g,"").replace(/-/g,"+").replace(/_/g,"/");
      const pad = b64.length % 4; if (pad) b64 += "=".repeat(4 - pad);
      const bin = atob(b64);
      const u8  = new Uint8Array(bin.length);
      for (let i=0;i<bin.length;i++) u8[i] = bin.charCodeAt(i);
      return u8;
    }

    btn.addEventListener("click", async () => {
      try {
        const phantom = window.solana || window.phantom?.solana;
        if (!phantom?.isPhantom) return setERR("‚ùå Phantom wallet niet gevonden.");

        const { publicKey } = await phantom.connect({ onlyIfTrusted:false });
        statusEl.className = ""; statusEl.textContent = "‚è≥ Claim voorbereiden‚Ä¶";

        // Vraag gedeeltelijk getekende tx op
        const resp = await fetch(ENDPOINT, {
          method: "POST",
          headers: { "content-type": "application/json" },
          body: JSON.stringify({ buyer: publicKey.toString() })
        });
        const data = await resp.json().catch(()=>null);
        if (!resp.ok || !data?.tx) {
          return setERR("‚ùå Server-fout: " + (data?.error || await resp.text()));
        }

        // Decode & verstuur
        const { Transaction, Connection } = await import("https://esm.sh/@solana/web3.js@1.95.3");
        const tx = Transaction.from(b64ToU8(data.tx));

        if (typeof phantom.signAndSendTransaction === "function") {
          const res = await phantom.signAndSendTransaction(tx);
          const sig = res?.signature ?? res;
          setOK(`‚úÖ 250 CBS verstuurd! ${link("https://solscan.io/tx/"+sig, "Bekijk transactie")}`);
          confetti({ particleCount: 160, spread: 70, origin: { y: 0.6 } });
          return;
        }

        // Fallback: signTransaction + sendRawTransaction via je proxy
        const signed = await phantom.signTransaction(tx);
        const rawB64 = u8ToB64(signed.serialize());
        const rpcResp = await fetch(RPC_PROXY, {
          method: "POST",
          headers: { "content-type": "application/json" },
          body: JSON.stringify({
            jsonrpc: "2.0",
            id: 1,
            method: "sendRawTransaction",
            params: [ rawB64, { skipPreflight: false } ]
          })
        }).then(r => r.json());

        if (rpcResp?.result) {
          setOK(`‚úÖ 250 CBS verstuurd! ${link("https://solscan.io/tx/"+rpcResp.result, "Bekijk transactie")}`);
          confetti({ particleCount: 160, spread: 70, origin: { y: 0.6 } });
        } else {
          setERR("‚ùå Verzend-fout: " + (rpcResp?.error?.message || "onbekend"));
        }
      } catch (e) {
        console.error(e);
        setERR("‚ùå " + (e?.message || e));
      }
    });
  </script>
</body>
</html>

